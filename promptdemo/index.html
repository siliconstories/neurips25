<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading Application...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for smooth transitions */
        #loader-container {
            transition: opacity 1s ease-in-out;
        }
        #progress-bar-inner {
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1); /* A smoother easing function */
        }
    </style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen flex flex-col items-center justify-center p-4 font-sans">
    
    <!-- Loader UI -->
    <div id="loader-container" class="w-full max-w-sm">
        <div id="loader-info" class="text-center mb-4">
            <p class="text-lg text-gray-300 mb-2">Loading from GitHub...</p>
            <a href="https://github.com/siliconstories/neurips25" target="_blank" rel="noopener noreferrer" class="text-xs text-gray-500 hover:text-gray-300 transition-colors">
                www.github.com/siliconstories/neurips25
            </a>
        </div>
        <!-- Progress Bar -->
        <div id="progress-bar-container" class="w-full bg-gray-800 rounded-full h-2 overflow-hidden">
            <div id="progress-bar-inner" class="h-2 rounded-full bg-cyan-400" style="width: 0%;"></div>
        </div>
        
        <!-- Error Message Area -->
        <p id="loader-error" class="text-red-400 mt-4 text-center text-sm h-5"></p>
    </div>
    <script>
        // --- DOM Element References ---
        const progressBarInner = document.getElementById('progress-bar-inner');
        const loaderContainer = document.getElementById('loader-container');
        const loaderError = document.getElementById('loader-error');
        const progressBarContainer = document.getElementById('progress-bar-container');
        // --- Configuration: URLs for files hosted on GitHub ---
        const GITHUB_BASE_URL = 'https://raw.githubusercontent.com/siliconstories/neurips25/main/promptdemo/';
        const APP_PAGE_URL = GITHUB_BASE_URL + 'index.html';
        const PROMPT_WITH_URL = GITHUB_BASE_URL + 'promptfiles/dreaming_with.txt';
        const PROMPT_WITHOUT_URL = GITHUB_BASE_URL + 'promptfiles/dreaming_without.txt';
        /**
         * Fetches all required application files from GitHub.
         * @returns {Promise<[string, string, string]>} A promise that resolves with the text content of the files.
         */
        async function fetchAppFiles() {
            // Use a cache-busting query parameter to ensure the latest files are fetched
            const cacheBuster = `?t=${new Date().getTime()}`;
            // Fetch all required resources in parallel
            const responses = await Promise.all([
                fetch(APP_PAGE_URL + cacheBuster),
                fetch(PROMPT_WITH_URL + cacheBuster),
                fetch(PROMPT_WITHOUT_URL + cacheBuster)
            ]);
            // Check if all network requests were successful
            for (const res of responses) {
                if (!res.ok) {
                    // Throw an error that includes the URL and status for better debugging
                    throw new Error(`Request failed for ${res.url} with status ${res.status}`);
                }
            }
            // Get the text content from each response and return it
            return Promise.all(responses.map(res => res.text()));
        }
        /**
         * Main function to orchestrate the loading process, animation, and transition.
         */
        async function initializeLoader() {
            // --- Start the progress bar animation ---
            // We wrap this in a setTimeout to ensure the browser renders the initial 0% width before transitioning.
            setTimeout(() => {
                progressBarInner.style.width = '100%';
            }, 10);
            try {
                // --- Fetch application data ---
                const [appHtml, promptWithText, promptWithoutText] = await fetchAppFiles();
                // --- Handle Successful Load ---
                // Wait for the 2-second progress bar animation to complete.
                setTimeout(() => {
                    // Start the 1-second fade-out transition.
                    loaderContainer.style.opacity = '0';
                    
                    // After the fade-out is complete, replace the document.
                    setTimeout(() => {
                        sessionStorage.setItem('prompt_with_examples', promptWithText);
                        sessionStorage.setItem('prompt_without_examples', promptWithoutText);
                        
                        document.open();
                        document.write(appHtml);
                        document.close();
                    }, 1000); // 1 second for fade-out
                }, 2000); // 2 seconds for progress bar
            } catch (error) {
                // --- Handle Loading Failure ---
                console.error("Failed to load application:", error);
                
                // Wait a moment to ensure the user sees the progress bar before it turns red.
                setTimeout(() => {
                    // Visually indicate the error state
                    progressBarInner.classList.remove('bg-cyan-400');
                    progressBarInner.classList.add('bg-red-500');
                    // Ensure the bar is full width but in red to show a completed but failed attempt.
                    progressBarInner.style.width = '100%'; 
                    loaderError.textContent = `Error: Could not load resources. Please check the network and refresh.`;
                }, 500); // A brief delay before showing the error
            }
        }
        // --- Start the entire process on page load ---
        initializeLoader();
    </script>
</body>
</html>